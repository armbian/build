#!/bin/bash
#
# Copyright (c) Authors: https://www.armbian.com/authors
#
# This file is licensed under the terms of the GNU General Public
# License version 2. This program is licensed "as is" without any
# warranty of any kind, whether express or implied.

# DO NOT EDIT THIS FILE but add config options to /etc/default/armbian-motd
# any changes will be lost on board support package update

THIS_SCRIPT="updates"
MOTD_DISABLE=""

[[ -f /etc/default/armbian-motd ]] && . /etc/default/armbian-motd

for f in $MOTD_DISABLE; do
	[[ $f == $THIS_SCRIPT ]] && exit 0
done

NUM_UPDATES=0
NUM_ONHOLD=0

[[ -f /var/cache/apt/archives/updates.number ]] && . /var/cache/apt/archives/updates.number
[[ -f /var/lib/dpkg/status ]] && NUM_ONHOLD=$(cat /var/lib/dpkg/status | grep -A 1 -B 1 hold | grep Package | cut -d" " -f2 | grep linux- | wc -l)

if [[ $NUM_UPDATES -gt 0 ]]; then
	echo -en "[\e[31m $NUM_SECURITY_UPDATES security updates available, $NUM_UPDATES updates total\e[0m: \e[1mapt upgrade\e[0m "
	[[ $NUM_ONHOLD -gt 0 ]] && echo -en "| \e[31mkernel upgrade:\e[0m \e[1marmbian-config\e[0m "
	echo -e "]"
	echo -e "Last check: \e[92m$DATE\e[0m"
	echo
fi
