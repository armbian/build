#!/bin/sh

# We're passed the version of the kernel being installed
inst_kern=$1

if [ -e /boot/vmlinuz-$inst_kern ]; then
  ln -sfT vmlinuz-$inst_kern /boot/vmlinuz > /dev/null 2>&1 || cp -aT /boot/vmlinuz-$inst_kern /boot/vmlinuz
fi
if [ -e /boot/dtbs/$inst_kern ]; then
  # Vanilla Linux
  if ! ln -sfT dtbs/$inst_kern /boot/dtb > /dev/null 2>&1; then
    rm -rf /boot/dtb
    cp -aRT /boot/dtbs/$inst_kern /boot/dtb
  fi
elif [ -e /usr/lib/linux-kernel-$inst_kern ]; then
  # Debian/Ubuntu Linux
  if ! ln -sfT /usr/lib/linux-kernel-$inst_kern /boot/dtb > /dev/null 2>&1; then
    rm -rf /boot/dtb
    cp -aRT /boot/dtbs/$inst_kern /boot/dtb
  fi
fi
exit 0
