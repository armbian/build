#!/bin/sh
# /etc/initramfs-tools/hooks/initramfs-hook-qcs6490-fw

PREREQ=""

prereqs() {
    echo "$PREREQ"
}

case $1 in
    prereqs)
        prereqs
        exit 0
        ;;
esac

. /usr/share/initramfs-tools/hook-functions

# Function to copy firmware files with glob support
copy_gpu_firmware() {
    pattern="$1"
    found=0

    for file in /lib/firmware/$pattern; do
        if [ -e "$file" ]; then
            copy_file firmware "$file" "/lib/firmware/${file#/lib/firmware/}"
            found=1
        fi
    done

    if [ $found -eq 0 ]; then
        echo "Warning: No GPU firmware found for pattern: $pattern" >&2
    fi
}

echo "Adding QCS6490 A660 GPU firmware files to initramfs..."

# Copy A660 GPU firmware files
copy_gpu_firmware "qcom/qcs6490/a660_zap.mbn"

echo "QCS6490 A660 GPU firmware files added to initramfs"
