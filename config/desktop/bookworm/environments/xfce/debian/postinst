# overwrite stock lightdm greeter configuration
if [ -d /etc/armbian/lightdm ]; then cp -R /etc/armbian/lightdm /etc/; fi

# Disable Pulseaudio timer scheduling which does not work with sndhdmi driver
if [ -f /etc/pulse/default.pa ]; then sed "s/load-module module-udev-detect$/& tsched=0/g" -i  /etc/pulse/default.pa; fi

# Setup new xdg for armbian
if [ -d /etc/xdg ]; then cp -rv /etc/xdg /etc/xdg-armbian;
cp -rp /etc/armbian/xdg-xfce/xfce4/. /etc/xdg-armbian/xfce4;
cp /etc/armbian/xdg-xfce/autostart/. /etc/xdg-armbian/autostart; 
fi

# Adjust menu
if [ -f /etc/xdg-armbian/menus/xfce-applications.menu ]; then
sed -i -n '/<Menuname>Settings<\/Menuname>/{p;:a;N;/<Filename>xfce4-session-logout.desktop<\/Filename>/!ba;s/.*\n/\
\t<Separator\/>\n\t<Merge type="all"\/>\n        <Separator\/>\n        <Filename>armbian-donate.desktop<\/Filename>\
\n        <Filename>armbian-support.desktop<\/Filename>\n/};p' /etc/xdg/menus/xfce-applications.menu
fi

#set new xfce pre-cconfig dir
if [ -f /etc/environment ]; then cat <<EOF > /etc/environment
XDG_CONFIG_DIRS="/etc/xdg-armbian"
EOF
fi
