# Rockchip RK3399 hexa core 3/4GB RAM SoC GBE eMMC USB3 USB-C WiFi/BT
# Uses the same u-boot dtb from Orangepi4 original board, but sets
# specific kernel DTB with BOOT_FDT_FILE directive
BOARD_NAME="Orange Pi 4 LTS"
BOARDFAMILY="rk3399"
BOARD_MAINTAINER="paolosabatino"
BOOTCONFIG="orangepi-4-rk3399_defconfig"
BOOT_FDT_FILE="rockchip/rk3399-orangepi-4-lts.dtb"
KERNEL_TARGET="current,edge"
MODULES_CURRENT="sprdbt_tty sprdwl_ng"
MODULES_EDGE="sprdbt_tty sprdwl_ng"
FULL_DESKTOP="yes"
ASOUND_STATE="asound.state.rk3399"
BOOT_LOGO="desktop"
BOOTBRANCH_BOARD="tag:v2022.04"
BOOTPATCHDIR="u-boot-rockchip64-v2022.04"

function post_family_tweaks_bsp__OPi4lts() {
    display_alert "Installing BSP firmware and fixups"

	if [[ $BRANCH == legacy ]]; then

		# Bluetooth for most of others (custom patchram is needed only in legacy)
		install -m 755 $SRC/packages/bsp/rk3399/brcm_patchram_plus_rk3399 $destination/usr/bin
		cp $SRC/packages/bsp/rk3399/rk3399-bluetooth.service $destination/lib/systemd/system/

	fi

	# Bluetooth on orangepi 4 LTS board is handled by a Spreadtrum (sprd) chip and requires
	# a custom hciattach_opi binary, plus a systemd service to run it at boot time
	install -m 755 $SRC/packages/bsp/rk3399/hciattach_opi $destination/usr/bin
	cp $SRC/packages/bsp/rk3399/sprd-bluetooth.service $destination/lib/systemd/system/

	return 0
}

