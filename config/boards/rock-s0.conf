# Rockchip RK3308 quad core 512MB SoC WiFi
# https://radxa.com/products/rocks/s0

BOARD_NAME="Rock S0"
BOARDFAMILY="rockchip64"
BOARD_MAINTAINER="brentr"

BOOTCONFIG="rock-s0-rk3308_defconfig"
BOOT_FDT_FILE="rockchip/rk3308-rock-s0.dtb"

KERNEL_TARGET="current,edge"
KERNEL_TEST_TARGET="current"

DEFAULT_CONSOLE="serial"
SERIALCON="ttyS0"
MODULES_BLACKLIST="rockchipdrm analogix_dp dw_mipi_dsi dw_hdmi gpu_sched lima hantro_vpu panfrost"
HAS_VIDEO_OUTPUT="no"
BOOTBRANCH_BOARD="tag:v2024.10"
BOOTPATCHDIR="v2024.10"

OVERLAY_PREFIX='rk3308'

function post_family_config__rk3308_use_mainline_uboot() {
	display_alert "$BOARD" "Mainline U-Boot overrides for $BOARD - $BRANCH" "info"
	unset BOOTFS_TYPE # fixes armbian-install and unneeded for modern uboot anyway
	declare -g BOOTDIR="u-boot-${BOARD}"
        rockBlob=${SRC}/packages/blobs/rockchip
        tpl=$rockBlob/rk3308_ddr_589MHz_uart0_m0_v2.07.bin
        bl31=$rockBlob/rk3308_bl31_v2.26.elf
	declare -g UBOOT_TARGET_MAP="BL31=$bl31 ROCKCHIP_TPL=$tpl;;u-boot-rockchip.bin"
	declare -g BOOTSCRIPT=boot-rockchip64-ttyS0.cmd:boot.cmd

	# disable stuff from rockchip64_common; we're using binman here which does all the work already
	unset uboot_custom_postprocess write_uboot_platform_mtd
        unset family_tweaks_bsp

	# Just use the binman-provided u-boot-rockchip.bin, which is ready-to-go
	function write_uboot_platform() {
		dd "if=$1/u-boot-rockchip.bin" "of=$2" bs=32k seek=1 conv=notrunc status=none
	}
}
