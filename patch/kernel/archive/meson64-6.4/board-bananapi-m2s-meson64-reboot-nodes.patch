From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@gmail.com>
Date: Sun, 9 July 2023 07:12:42 -0400
Subject: [PATCH] Add support for the meson64-reboot driver

Add support for the meson64-reboot driver

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
diff -Naur a/arch/arm64/boot/dts/amlogic/meson-g12b-a311d-bananapi-m2s.dts b/arch/arm64/boot/dts/amlogic/meson-g12b-a311d-bananapi-m2s.dts
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-a311d-bananapi-m2s.dts	2023-07-01 07:12:42.000000000 -0400
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-a311d-bananapi-m2s.dts	2023-07-09 07:07:01.116609978 -0400
@@ -18,6 +18,10 @@
 	};
 };
 
+&reboot {
+	sd-vqen = <&gpio_ao GPIOAO_3 GPIO_ACTIVE_HIGH>;
+};
+
 /* Camera (CSI) bus */
 &i2c1 {
 	status = "okay";
diff -Naur a/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi.dtsi
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi.dtsi	2023-07-01 07:12:42.000000000 -0400
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi.dtsi	2023-07-09 07:06:35.952527545 -0400
@@ -17,6 +17,15 @@
 		rtc1 = &vrtc;
 	};
 
+	reboot: meson64-reboot {
+		compatible = "meson64,reboot";
+		sys_reset = <0x84000009>;
+		sys_poweroff = <0x84000008>;
+
+		sd-vqsw = <&gpio_ao GPIOAO_9 GPIO_ACTIVE_HIGH>;
+		sd-vmmc = <&gpio_ao GPIOAO_8 GPIO_ACTIVE_HIGH>;
+	};
+
 	chosen {
 		stdout-path = "serial0:115200n8";
 	};
diff -Naur a/arch/arm64/boot/dts/amlogic/meson-g12b-s922x-bananapi-m2s.dts b/arch/arm64/boot/dts/amlogic/meson-g12b-s922x-bananapi-m2s.dts
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-s922x-bananapi-m2s.dts	2023-07-01 07:12:42.000000000 -0400
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-s922x-bananapi-m2s.dts	2023-07-09 07:07:28.228667931 -0400
@@ -12,3 +12,7 @@
 	compatible = "bananapi,bpi-m2s", "amlogic,s922x", "amlogic,g12b";
 	model = "BananaPi M2S";
 };
+
+&reboot {
+	sd-vqen = <&gpio_ao GPIOAO_3 GPIO_ACTIVE_HIGH>;
+};
