From bbd0a55fe73af933cdcdee5ff24fcabe7c7dfc56 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dawid=20Wro=CC=81bel?= <me@dawidwrobel.com>
Date: Sat, 1 Nov 2025 09:41:42 +0100
Subject: [PATCH 56/62] arm64: dts: qcom: sm8250: remote heap CMA for ADSP,
 CDSP, SLPI
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

ADSP, CDSP and SLPI DSPs' FastRPC requires remote heap CMA
memory region to e.g. load files from the host filesystem,
such as sensor configuration files, CV kernels, codecs, etc.

Add a missing DMA region, similar to downstream, and reference
it in ADSP, CDSP and SLPI fastrpc nodes.

Signed-off-by: Dawid Wr√≥bel <me@dawidwrobel.com>
Signed-off-by: Jiali Chen <chenjiali@radxa.com>
---
 arch/arm64/boot/dts/qcom/sm8250.dtsi | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/arch/arm64/boot/dts/qcom/sm8250.dtsi b/arch/arm64/boot/dts/qcom/sm8250.dtsi
index 823b88674d3e..3e01bc79e481 100644
--- a/arch/arm64/boot/dts/qcom/sm8250.dtsi
+++ b/arch/arm64/boot/dts/qcom/sm8250.dtsi
@@ -858,6 +858,14 @@ cdsp_secure_heap: memory@8bf00000 {
 			reg = <0x0 0x8bf00000 0x0 0x4600000>;
 			no-map;
 		};
+
+		fastrpc_mem: fastrpc {
+			compatible = "shared-dma-pool";
+			alloc-ranges = <0x0 0x00000000 0x0 0xffffffff>;
+			alignment = <0x0 0x400000>;
+			size = <0x0 0x2000000>;
+			reusable;
+		};
 	};
 
 	smem {
@@ -3117,6 +3125,7 @@ fastrpc {
 					qcom,glink-channels = "fastrpcglink-apps-dsp";
 					label = "sdsp";
 					qcom,non-secure-domain;
+					memory-region = <&fastrpc_mem>;
 					#address-cells = <1>;
 					#size-cells = <0>;
 
@@ -3819,6 +3828,7 @@ fastrpc {
 					qcom,glink-channels = "fastrpcglink-apps-dsp";
 					label = "cdsp";
 					qcom,non-secure-domain;
+					memory-region = <&fastrpc_mem>;
 					#address-cells = <1>;
 					#size-cells = <0>;
 
@@ -6077,6 +6087,7 @@ fastrpc {
 					qcom,glink-channels = "fastrpcglink-apps-dsp";
 					label = "adsp";
 					qcom,non-secure-domain;
+					memory-region = <&fastrpc_mem>;
 					#address-cells = <1>;
 					#size-cells = <0>;
 
-- 
2.47.3

