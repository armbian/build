From 3c0fe31689c380b1ebaaf7327a2585248eacecad Mon Sep 17 00:00:00 2001
From: Paolo Sabatino <paolo.sabatino@gmail.com>
Date: Fri, 7 Jul 2023 16:00:15 +0200
Subject: [PATCH] prefer 8-bit RGB over YCbCr

---
 drivers/gpu/drm/bridge/synopsys/dw-hdmi.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c b/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c
index 36c8dc302de1..2944fc0a236e 100644
--- a/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c
+++ b/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c
@@ -2749,10 +2749,6 @@ static u32 *dw_hdmi_bridge_atomic_get_output_bus_fmts(struct drm_bridge *bridge,
 	 * if supported. In any case the default RGB888 format is added
 	 */
 
-	/* Default 8bit RGB fallback */
-	if (is_tmds_allowed(info, mode, MEDIA_BUS_FMT_RGB888_1X24))
-		output_fmts[i++] = MEDIA_BUS_FMT_RGB888_1X24;
-
 	if (max_bpc >= 16 && info->bpc == 16) {
 		if ((info->color_formats & DRM_COLOR_FORMAT_YCBCR444) &&
 		    is_tmds_allowed(info, mode, MEDIA_BUS_FMT_YUV16_1X48))
@@ -2788,6 +2784,10 @@ static u32 *dw_hdmi_bridge_atomic_get_output_bus_fmts(struct drm_bridge *bridge,
 			output_fmts[i++] = MEDIA_BUS_FMT_RGB101010_1X30;
 	}
 
+	/* Prefer 8-bit RGB over YCbCr formats */
+	if (is_tmds_allowed(info, mode, MEDIA_BUS_FMT_RGB888_1X24))
+		output_fmts[i++] = MEDIA_BUS_FMT_RGB888_1X24;
+
 	if ((info->color_formats & DRM_COLOR_FORMAT_YCBCR422) &&
 	    is_tmds_allowed(info, mode, MEDIA_BUS_FMT_UYVY8_1X16))
 		output_fmts[i++] = MEDIA_BUS_FMT_UYVY8_1X16;
-- 
2.34.1

