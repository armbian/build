From 964595fb37e75f1b86cec9c8260b004f0f0f307d Mon Sep 17 00:00:00 2001
From: "steve.jeong" <jkhpro1003@gmail.com>
Date: Tue, 19 Jul 2022 15:19:23 +0900
Subject: [PATCH 95/99] ODROID-M1: dtb/dtbo: Add uart0 overlay

Signed-off-by: steve.jeong <jkhpro1003@gmail.com>
Change-Id: I8ea5c7378a73bfea67daa05c52913e3c746954b2
---
 .../boot/dts/rockchip/overlays/odroidm1/Makefile   |  2 ++
 .../overlays/odroidm1/uart0-with-ctsrts.dts        | 14 ++++++++++++++
 .../boot/dts/rockchip/overlays/odroidm1/uart0.dts  | 13 +++++++++++++
 arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts  |  8 ++++++++
 4 files changed, 37 insertions(+)
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0-with-ctsrts.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0.dts

diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
index e634ff19b456..dcd692f5331d 100644
--- a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
@@ -5,6 +5,8 @@ dtbo-y += \
 	pwm1.dtbo \
 	pwm2.dtbo \
 	pwm9.dtbo \
+	uart0-with-ctsrts.dtbo \
+	uart0.dtbo \
 	uart1.dtbo
 
 targets += $(dtbo-y)
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0-with-ctsrts.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0-with-ctsrts.dts
new file mode 100644
index 000000000000..fb855965f9ae
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0-with-ctsrts.dts
@@ -0,0 +1,14 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// uart1 aliased with serial0.
+		target = <&uart1>;
+
+		__overlay__ {
+			status = "okay";
+			pinctrl-names = "not_use_it", "default";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0.dts
new file mode 100644
index 000000000000..e57ba5499820
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart0.dts
@@ -0,0 +1,13 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// uart1 aliased with serial0.
+		target = <&uart1>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts b/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
index bfc89a73eacb..6f368fa17f9b 100644
--- a/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
@@ -601,6 +601,14 @@ &tsadc {
 	status = "okay";
 };
 
+&uart1 {
+	dma-names = "tx", "rx";
+	/* uart1 uart1-with-ctsrts */
+	pinctrl-0 = <&uart1m1_xfer>;
+	pinctrl-1 = <&uart1m1_xfer &uart1m1_ctsn &uart1m1_rtsn>;
+	status = "disabled";
+};
+
 &uart2 {
 	status = "okay";
 };
-- 
2.37.3

