From 34a77d2da9d7c3383deb419b1fb2aec44f8f91bf Mon Sep 17 00:00:00 2001
From: "steve.jeong" <jkhpro1003@gmail.com>
Date: Wed, 20 Jul 2022 17:54:29 +0900
Subject: [PATCH 98/99] ODROID-N2/C4: dtb/dtbo: Add spi overlay

Signed-off-by: steve.jeong <jkhpro1003@gmail.com>
Change-Id: Ice09457178d84b2f7e98c0ad6525476b835e537b
---
 arch/arm64/boot/dts/amlogic/meson-g12b-odroid-n2.dtsi | 11 +----------
 arch/arm64/boot/dts/amlogic/meson-sm1-odroid.dtsi     |  7 +++++++
 .../arm64/boot/dts/amlogic/overlays/odroidc4/spi0.dts |  7 +++++--
 .../arm64/boot/dts/amlogic/overlays/odroidn2/spi0.dts |  7 +++++--
 4 files changed, 18 insertions(+), 14 deletions(-)

diff --git a/arch/arm64/boot/dts/amlogic/meson-g12b-odroid-n2.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12b-odroid-n2.dtsi
index 0b81f7bcd400..86909b0ff6ae 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-odroid-n2.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-odroid-n2.dtsi
@@ -712,17 +712,8 @@ &toddr_c {
 
 &spicc0 {
 	status = "disabled";
-
 	pinctrl-names = "default";
-	pinctrl-0 = <&spicc0_x_pins>;
-
-	spidev@0 {
-		status = "okay";
-
-		compatible = "linux,spidev";
-		reg = <0>;
-		spi-max-frequency = <100000000>;
-	};
+	pinctrl-0 = <&spicc0_ss0_x_pins &spicc0_x_pins>;
 };
 
 &uart_A {
diff --git a/arch/arm64/boot/dts/amlogic/meson-sm1-odroid.dtsi b/arch/arm64/boot/dts/amlogic/meson-sm1-odroid.dtsi
index 745298b31755..87a5718eada5 100644
--- a/arch/arm64/boot/dts/amlogic/meson-sm1-odroid.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-sm1-odroid.dtsi
@@ -21,6 +21,7 @@ aliases {
 		serial3 = &uart_C;
 		serial4 = &uart_AO_B;
 		ethernet0 = &ethmac;
+		spi0 = &spicc0;
 	};
 
 	chosen {
@@ -447,6 +448,12 @@ &sd_emmc_c {
 	vqmmc-supply = <&flash_1v8>;
 };
 
+&spicc0 {
+	status = "disabled";
+	pinctrl-names = "default";
+	pinctrl-0 = <&spicc0_ss0_x_pins &spicc0_x_pins>;
+};
+
 &tdmif_b {
 	status = "okay";
 };
diff --git a/arch/arm64/boot/dts/amlogic/overlays/odroidc4/spi0.dts b/arch/arm64/boot/dts/amlogic/overlays/odroidc4/spi0.dts
index da9817758bea..4fd45bc4a5a9 100644
--- a/arch/arm64/boot/dts/amlogic/overlays/odroidc4/spi0.dts
+++ b/arch/arm64/boot/dts/amlogic/overlays/odroidc4/spi0.dts
@@ -10,10 +10,13 @@ fragment@0 {
 
 		__overlay__ {
 			status = "okay";
-
-			cs-gpios = <&gpio GPIOX_10 GPIO_ACTIVE_LOW>;
+			#address-cells = <1>;
+			#size-cells = <0>;
 
 			spidev: spidev@0 {
+				status = "okay";
+				compatible = "odroid,spi-dev";
+				reg = <0>;
 				spi-max-frequency = <100000000>;
 			};
 		};
diff --git a/arch/arm64/boot/dts/amlogic/overlays/odroidn2/spi0.dts b/arch/arm64/boot/dts/amlogic/overlays/odroidn2/spi0.dts
index da9817758bea..4fd45bc4a5a9 100644
--- a/arch/arm64/boot/dts/amlogic/overlays/odroidn2/spi0.dts
+++ b/arch/arm64/boot/dts/amlogic/overlays/odroidn2/spi0.dts
@@ -10,10 +10,13 @@ fragment@0 {
 
 		__overlay__ {
 			status = "okay";
-
-			cs-gpios = <&gpio GPIOX_10 GPIO_ACTIVE_LOW>;
+			#address-cells = <1>;
+			#size-cells = <0>;
 
 			spidev: spidev@0 {
+				status = "okay";
+				compatible = "odroid,spi-dev";
+				reg = <0>;
 				spi-max-frequency = <100000000>;
 			};
 		};
-- 
2.37.3

