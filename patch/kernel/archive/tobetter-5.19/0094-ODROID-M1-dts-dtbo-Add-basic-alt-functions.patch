From 3fae367e94a41efe0748d76bbb4102dcbf529912 Mon Sep 17 00:00:00 2001
From: "steve.jeong" <jkhpro1003@gmail.com>
Date: Mon, 11 Jul 2022 16:42:22 +0900
Subject: [PATCH 94/99] ODROID-M1: dts/dtbo: Add basic alt functions

and modify pinctrls for 40 header pins

Signed-off-by: steve.jeong <jkhpro1003@gmail.com>
Change-Id: Iefdf7d724489a4ad026d42127e8dbd620d36bde4
---
 arch/arm64/boot/dts/rockchip/Makefile         |  2 ++
 .../dts/rockchip/overlays/odroidm1/Makefile   | 11 +++++++++++
 .../dts/rockchip/overlays/odroidm1/i2c0.dts   | 14 ++++++++++++++
 .../dts/rockchip/overlays/odroidm1/i2c1.dts   | 12 ++++++++++++
 .../rockchip/overlays/odroidm1/onewire.dts    | 19 +++++++++++++++++++
 .../dts/rockchip/overlays/odroidm1/pwm1.dts   | 13 +++++++++++++
 .../dts/rockchip/overlays/odroidm1/pwm2.dts   | 13 +++++++++++++
 .../dts/rockchip/overlays/odroidm1/pwm9.dts   | 13 +++++++++++++
 .../dts/rockchip/overlays/odroidm1/uart1.dts  | 15 +++++++++++++++
 .../boot/dts/rockchip/rk3568-odroid-m1.dts    | 17 ++++++++++++++++-
 10 files changed, 128 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c0.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c1.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/onewire.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm1.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm2.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm9.dts
 create mode 100644 arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart1.dts

diff --git a/arch/arm64/boot/dts/rockchip/Makefile b/arch/arm64/boot/dts/rockchip/Makefile
index c06fe8406c5b..2c688c0056a3 100644
--- a/arch/arm64/boot/dts/rockchip/Makefile
+++ b/arch/arm64/boot/dts/rockchip/Makefile
@@ -67,3 +67,5 @@ dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3568-bpi-r2-pro.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3568-evb1-v10.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3568-odroid-m1.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3568-rock-3a.dtb
+
+subdir-y += overlays/odroidm1
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
new file mode 100644
index 000000000000..e634ff19b456
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/Makefile
@@ -0,0 +1,11 @@
+dtbo-y += \
+	i2c0.dtbo \
+	i2c1.dtbo \
+	onewire.dtbo \
+	pwm1.dtbo \
+	pwm2.dtbo \
+	pwm9.dtbo \
+	uart1.dtbo
+
+targets += $(dtbo-y)
+always-y := $(dtbo-y)
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c0.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c0.dts
new file mode 100644
index 000000000000..a6942df06650
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c0.dts
@@ -0,0 +1,14 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// i2c3 aliased with i2c0.
+		// This activates i2c3 but it will be named as i2c0 on the userspace.
+		target = <&i2c3>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c1.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c1.dts
new file mode 100644
index 000000000000..7cb8b7971e41
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/i2c1.dts
@@ -0,0 +1,12 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		target = <&i2c1>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
\ No newline at end of file
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/onewire.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/onewire.dts
new file mode 100644
index 000000000000..e02850ed2372
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/onewire.dts
@@ -0,0 +1,19 @@
+/dts-v1/;
+/plugin/;
+
+#include <dt-bindings/gpio/gpio.h>
+#include <dt-bindings/pinctrl/rockchip.h>
+
+/ {
+	fragment@0 {
+		target-path = "/";
+
+		__overlay__ {
+				onewire:onewire {
+					compatible = "w1-gpio";
+					gpios = <&gpio3 RK_PB2 GPIO_ACTIVE_HIGH>;
+					status = "okay";
+			};
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm1.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm1.dts
new file mode 100644
index 000000000000..0b78ad96ba8b
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm1.dts
@@ -0,0 +1,13 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// pwmchip0, pwm@fdd70010
+		target = <&pwm1>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm2.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm2.dts
new file mode 100644
index 000000000000..c7f1898e5903
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm2.dts
@@ -0,0 +1,13 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// pwmchip1, pwm@fdd70020
+		target = <&pwm2>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm9.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm9.dts
new file mode 100644
index 000000000000..7f52929e787c
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/pwm9.dts
@@ -0,0 +1,13 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// pwmchip3, pwm@fe6f0010
+		target = <&pwm9>;
+
+		__overlay__ {
+			status = "okay";
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart1.dts b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart1.dts
new file mode 100644
index 000000000000..cab55b10c0cc
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/overlays/odroidm1/uart1.dts
@@ -0,0 +1,15 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	fragment@0 {
+		// uart0 aliased with serial1.
+		target = <&uart0>;
+
+		__overlay__ {
+			status = "okay";
+
+			dma-names = "tx", "rx";
+		};
+	};
+};
\ No newline at end of file
diff --git a/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts b/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
index c2792c04c949..bfc89a73eacb 100644
--- a/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3568-odroid-m1.dts
@@ -477,6 +477,12 @@ codec {
 	};
 };
 
+&i2c3 {
+	status = "disabled";
+	pinctrl-names = "default";
+	pinctrl-0 = <&i2c3m1_xfer>;
+};
+
 &i2s0_8ch {
 	status = "okay";
 };
@@ -496,7 +502,6 @@ rgmii_phy0: ethernet-phy@0 {
 	};
 };
 
-
 &pcie30phy {
 	status = "okay";
 };
@@ -547,6 +552,16 @@ &pmu_io_domains {
 	status = "okay";
 };
 
+&pwm1 {
+	status = "disabled";
+	pinctrl-0 = <&pwm1m1_pins>;
+};
+
+&pwm2 {
+	status = "disabled";
+	pinctrl-0 = <&pwm2m1_pins>;
+};
+
 &saradc {
 	vref-supply = <&vcca_1v8>;
 	status = "okay";
-- 
2.37.3

