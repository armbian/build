From fc761238a721b15b575abcab0f029141a3734875 Mon Sep 17 00:00:00 2001
From: Jianhua Lu <lujianhua000@gmail.com>
Date: Sat, 2 Aug 2025 07:46:34 +0800
Subject: [PATCH 31/62] arm64: dts: qcom: sm8250-xiaomi-elish: add pm8150b
 charger

Signed-off-by: Jiali Chen <chenjiali@radxa.com>
---
 .../dts/qcom/sm8250-xiaomi-elish-common.dtsi  | 30 ++++++++++---------
 1 file changed, 16 insertions(+), 14 deletions(-)

diff --git a/arch/arm64/boot/dts/qcom/sm8250-xiaomi-elish-common.dtsi b/arch/arm64/boot/dts/qcom/sm8250-xiaomi-elish-common.dtsi
index ae84f67fc308..e02088891802 100644
--- a/arch/arm64/boot/dts/qcom/sm8250-xiaomi-elish-common.dtsi
+++ b/arch/arm64/boot/dts/qcom/sm8250-xiaomi-elish-common.dtsi
@@ -37,18 +37,12 @@ aliases {
 		serial0 = &uart6;
 	};
 
-	battery_l: battery-l {
+	battery: battery {
 		compatible = "simple-battery";
 		voltage-min-design-microvolt = <3870000>;
-		energy-full-design-microwatt-hours = <16600000>;
-		charge-full-design-microamp-hours = <4300000>;
-	};
-
-	battery_r: battery-r {
-		compatible = "simple-battery";
-		voltage-min-design-microvolt = <3870000>;
-		energy-full-design-microwatt-hours = <16600000>;
-		charge-full-design-microamp-hours = <4300000>;
+		voltage-max-design-microvolt = <4500000>;
+		energy-full-design-microwatt-hours = <33200000>;
+		charge-full-design-microamp-hours = <8600000>;
 	};
 
 	bl_vddpos_5p5: bl-vddpos-regulator {
@@ -551,7 +545,8 @@ &i2c0 {
 	fuel-gauge@55 {
 		compatible = "ti,bq27z561";
 		reg = <0x55>;
-		monitored-battery = <&battery_r>;
+		monitored-battery = <&battery>;
+		power-supplies = <&bq25970_slave>;
 	};
 };
 
@@ -725,7 +720,8 @@ &i2c13 {
 	fuel-gauge@55 {
 		compatible = "ti,bq27z561";
 		reg = <0x55>;
-		monitored-battery = <&battery_l>;
+		monitored-battery = <&battery>;
+		power-supplies = <&bq25970_master>;
 	};
 };
 
@@ -733,7 +729,7 @@ &i2c15 {
 	clock-frequency = <400000>;
 	status = "ok";
 
-	bq25970-master@65 {
+	bq25970_master: bq25970-master@65 {
 		compatible = "ti,bq2597x-master";
 		reg = <0x65>;
 		interrupt-parent = <&tlmm>;
@@ -771,7 +767,7 @@ bq25970-master@65 {
 		sc8551,ac-ovp-threshold = <14>;
 	};
 
-	bq25970-slave@66 {
+	bq25970_slave: bq25970-slave@66 {
 		compatible = "ti,bq2597x-slave";
 		reg = <0x66>;
 		/*
@@ -925,6 +921,11 @@ wifi@0 {
 	};
 };
 
+&pm8150b_charger {
+	monitored-battery = <&battery>;
+	status = "okay";
+};
+
 &pm8150_gpios {
 	vol_up_n: vol-up-n-state {
 		pins = "gpio6";
@@ -943,6 +944,7 @@ connector {
 		compatible = "usb-c-connector";
 
 		op-sink-microwatt = <10000000>;
+		try-power-role = "sink";
 		power-role = "dual";
 		data-role = "dual";
 		self-powered;
-- 
2.47.3

