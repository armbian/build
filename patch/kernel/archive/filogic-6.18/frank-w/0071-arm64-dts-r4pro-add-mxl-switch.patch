From 63639826ff2a9e5ea20ed9834ad19bf4cf6386d9 Mon Sep 17 00:00:00 2001
From: Frank Wunderlich <frank-w@public-files.de>
Date: Sun, 26 Oct 2025 15:09:53 +0100
Subject: [PATCH 071/116] arm64: dts: r4pro: add mxl switch

---
 .../mt7988a-bananapi-bpi-r4-pro-8x.dts        | 49 +++++++++-
 .../mediatek/mt7988a-bananapi-bpi-r4-pro.dtsi | 92 +++++++++++++++++++
 2 files changed, 140 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro-8x.dts b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro-8x.dts
index 812986172bb2..2e95eebb4bf6 100644
--- a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro-8x.dts
+++ b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro-8x.dts
@@ -81,4 +81,51 @@ phy28_led1: led1@1 {
 			};
 		};
 	};
-};
\ No newline at end of file
+};
+
+&switch16 {
+	ds_mux: ds-mux-bus {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		ds_mux0: ds-mux@0 {
+			compatible = "mxl862xx,ds-mux";
+			reg = <12>;
+			chan-sel-gpios = <&pio 54 GPIO_ACTIVE_HIGH>;
+			mod-def0-gpios = <&pio 4 GPIO_ACTIVE_LOW>;
+			sfp-present-channel = <0>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			ds_channel_0: channel@0 {
+				reg = <0>;
+				phy-mode = "usxgmii";
+				phy-connection-type = "usxgmii";
+				managed = "in-band-status";
+				sfp = <&sfp1>;
+			};
+
+			ds_channel_1: channel@1 {
+				reg = <1>;
+				phy-mode = "10gbase-r";
+				phy-connection-type = "10gbase-r";
+				phy-handle = <&phy24>;
+			};
+		};
+	};
+	ports {
+		port6: port@6 {
+			reg = <12>;
+			label = "mxl_lan5";
+			phy-mode = "usxgmii";
+			phy-handle = <&phy24>;
+			status = "okay";
+
+			fixed-link {
+				speed = <10000>;
+				full-duplex;
+			};
+		};
+
+	};
+};
diff --git a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro.dtsi b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro.dtsi
index f65434e8cda3..f7deb9d2fb70 100644
--- a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro.dtsi
+++ b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4-pro.dtsi
@@ -392,6 +392,98 @@ wifi_eeprom: eeprom@51 {
 	};
 };
 
+&mdio_bus {
+	clock-frequency = <12500000>;
+
+	switch16: switch@16 {
+		compatible = "mxl,86252";
+		reg = <16>;
+		dsa,member = <0 0>;
+		status = "okay";
+
+		ports {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			port0: port@0 {
+				reg = <0>;
+				label = "mxl_lan0";
+				phy-handle = <&switchphy0>;
+				phy-mode = "internal";
+				status = "okay";
+			};
+
+			port1: port@1 {
+				reg = <1>;
+				label = "mxl_lan1";
+				phy-handle = <&switchphy1>;
+				phy-mode = "internal";
+				status = "okay";
+			};
+
+			port2: port@2 {
+				reg = <2>;
+				label = "mxl_lan2";
+				phy-handle = <&switchphy2>;
+				phy-mode = "internal";
+				status = "okay";
+			};
+
+			port3: port@3 {
+				reg = <3>;
+				label = "mxl_lan3";
+				phy-handle = <&switchphy3>;
+				phy-mode = "internal";
+				status = "okay";
+			};
+
+			port4: port@4 {
+				reg = <4>;
+				label = "mxl_lan4";
+				phy-handle = <&switchphy4>;
+				phy-mode = "internal";
+				status = "okay";
+			};
+
+			port8: port@8 {
+				reg = <8>;
+				label = "cpu";
+				phy-mode = "usxgmii";
+				ethernet = <&gmac2>;
+				dsa-tag-protocol = "mxl862_8021q";
+				fixed-link {
+					speed = <10000>;
+					full-duplex;
+				};
+			};
+		};
+
+		mdio {
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			switchphy0:switchphy@0 {
+				reg= <0>;
+			};
+
+			switchphy1:switchphy@1 {
+				reg= <1>;
+			};
+
+			switchphy2:switchphy@2 {
+				reg= <2>;
+			};
+
+			switchphy3:switchphy@3 {
+				reg= <3>;
+			};
+
+			switchphy4:switchphy@4 {
+				reg= <4>;
+			};
+		};
+	};
+};
+
 /* mPCIe SIM2 (11300000) */
 &pcie0 {
 	status = "okay";
-- 
2.39.5

