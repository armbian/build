From 4d51f25d116590c1e0773d31eae247786090fcb9 Mon Sep 17 00:00:00 2001
From: Frank Wunderlich <frank-w@public-files.de>
Date: Fri, 7 Nov 2025 22:24:35 +0100
Subject: [PATCH 107/116] arm64: dts: add bpi-r4 lite overlays

---
 arch/arm64/boot/dts/mediatek/Makefile         |  6 ++
 ...mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtso | 17 +++++
 ...mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtso | 17 +++++
 .../mt7987a-bananapi-bpi-r4-lite-emmc.dtso    | 33 +++++++++
 .../mt7987a-bananapi-bpi-r4-lite-nand.dtso    | 67 +++++++++++++++++++
 .../mt7987a-bananapi-bpi-r4-lite-nor.dtso     | 62 +++++++++++++++++
 .../mt7987a-bananapi-bpi-r4-lite-sd.dtso      | 31 +++++++++
 7 files changed, 233 insertions(+)
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtso
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtso
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-emmc.dtso
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nand.dtso
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nor.dtso
 create mode 100644 arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-sd.dtso

diff --git a/arch/arm64/boot/dts/mediatek/Makefile b/arch/arm64/boot/dts/mediatek/Makefile
index 3e9729227b36..652ed1c7f8c6 100644
--- a/arch/arm64/boot/dts/mediatek/Makefile
+++ b/arch/arm64/boot/dts/mediatek/Makefile
@@ -21,6 +21,12 @@ dtb-$(CONFIG_ARCH_MEDIATEK) += mt7986a-bananapi-bpi-r3-sata.dtbo
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7986a-bananapi-bpi-r3-sd.dtbo
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7986a-rfb.dtb
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7986b-rfb.dtb
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtbo
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtbo
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-sd.dtbo
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-emmc.dtbo
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-nand.dtbo
+dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite-nor.dtbo
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7987a-bananapi-bpi-r4-lite.dtb
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7988a-bananapi-bpi-r4.dtb
 dtb-$(CONFIG_ARCH_MEDIATEK) += mt7988a-bananapi-bpi-r4-2g5.dtb
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtso
new file mode 100644
index 000000000000..10815aada685
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-1pcie-2L.dtso
@@ -0,0 +1,17 @@
+// SPDX-License-Identifier: (GPL-2.0 OR MIT)
+/*
+ * Copyright (C) 2025 MediaTek Inc.
+ * Author: Sam.Shih <sam.shih@mediatek.com>
+ */
+/dts-v1/;
+/plugin/;
+#include <dt-bindings/gpio/gpio.h>
+
+&{/soc/pinctrl@1001f000/pcie-1-hog} {
+	output-high;
+};
+
+
+&{/soc/pcie@11290000} {
+	status = "disabled";
+};
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtso
new file mode 100644
index 000000000000..50af0925ccea
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-2pcie-1L.dtso
@@ -0,0 +1,17 @@
+// SPDX-License-Identifier: (GPL-2.0 OR MIT)
+/*
+ * Copyright (C) 2025 MediaTek Inc.
+ * Author: Sam.Shih <sam.shih@mediatek.com>
+ */
+/dts-v1/;
+/plugin/;
+#include <dt-bindings/gpio/gpio.h>
+
+&{/soc/pinctrl@1001f000/pcie-1-hog} {
+	output-low;
+};
+
+
+&{/soc/pcie@11290000} {
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-emmc.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-emmc.dtso
new file mode 100644
index 000000000000..ecbe0f400515
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-emmc.dtso
@@ -0,0 +1,33 @@
+// SPDX-License-Identifier: (GPL-2.0 OR MIT)
+/*
+ * Copyright (C) 2025 MediaTek Inc.
+ * Author: Frank Wunderlich <frank-w@public-files.de>
+ */
+
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "bananapi,bpi-r4-lite", "mediatek,mt7987a";
+};
+
+&{/soc/mmc@11230000} {
+	pinctrl-names = "default", "state_uhs";
+	pinctrl-0 = <&mmc_pins_default>;
+	pinctrl-1 = <&mmc_pins_uhs>;
+	bus-width = <4>; //due to dat5 = sdmmc cd pin
+	max-frequency = <52000000>;
+	cap-mmc-highspeed;
+	//mmc-hs200-1_8v;
+	//mmc-hs400-1_8v;
+	//hs400-ds-delay = <0x12814>;
+	vqmmc-supply = <&reg_1p8v>;
+	vmmc-supply = <&reg_3p3v>;
+	non-removable;
+	no-sd;
+	no-sdio;
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+};
+
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nand.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nand.dtso
new file mode 100644
index 000000000000..824b68ca524f
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nand.dtso
@@ -0,0 +1,67 @@
+/* SPDX-License-Identifier: (GPL-2.0-only OR MIT) */
+/*
+ * Authors: Daniel Golle <daniel@makrotopia.org>
+ *          Frank Wunderlich <frank-w@public-files.de>
+ */
+
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "bananapi,bpi-r4lite", "mediatek,mt7987a";
+};
+
+&{/soc/spi@11009800} {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	spi_nand: flash@0 {
+		compatible = "spi-nand";
+		reg = <0>;
+		spi-max-frequency = <10000000>;
+		spi-tx-bus-width = <4>;
+		spi-rx-bus-width = <4>;
+
+		partitions {
+			compatible = "fixed-partitions";
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			partition@0 {
+				label = "bl2";
+				reg = <0x0 0x200000>;
+			};
+
+			partition@200000 {
+				label = "ubi";
+				reg = <0x200000 0xfe00000>;
+				compatible = "linux,ubi";
+
+				volumes {
+					ubi-volume-fip {
+						volname = "fip";
+					};
+
+					ubi-volume-ubootenv {
+						volname = "ubootenv";
+						nvmem-layout {
+							compatible = "u-boot,env-redundant-bool";
+						};
+					};
+
+					ubi-volume-ubootenv2 {
+						volname = "ubootenv2";
+						nvmem-layout {
+							compatible = "u-boot,env-redundant-bool";
+						};
+					};
+
+					ubi_rootfs: ubi-volume-rootfs {
+						volname = "rootfs";
+					};
+				};
+			};
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nor.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nor.dtso
new file mode 100644
index 000000000000..62e2bb4a58da
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-nor.dtso
@@ -0,0 +1,62 @@
+/* SPDX-License-Identifier: (GPL-2.0-only OR MIT) */
+/*
+ * Authors: Daniel Golle <daniel@makrotopia.org>
+ *          Frank Wunderlich <frank-w@public-files.de>
+ */
+
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "bananapi,bpi-r4lite", "mediatek,mt7987a";
+};
+
+&{/soc/spi@11009800} {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	flash@0 {
+		compatible = "jedec,spi-nor";
+		reg = <0>;
+		spi-max-frequency = <10000000>;
+
+		partitions {
+			compatible = "fixed-partitions";
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			partition@0 {
+				label = "bl2";
+				reg = <0x0 0x40000>;
+				read-only;
+			};
+
+			partition@40000 {
+				label = "u-boot-env";
+				reg = <0x40000 0x40000>;
+			};
+
+			partition@80000 {
+				label = "reserved2";
+				reg = <0x80000 0x80000>;
+			};
+
+			partition@100000 {
+				label = "fip";
+				reg = <0x100000 0x80000>;
+				read-only;
+			};
+
+			partition@180000 {
+				label = "recovery";
+				reg = <0x180000 0xa80000>;
+			};
+
+			partition@c00000 {
+				label = "fit";
+				reg = <0xc00000 0x1400000>;
+			};
+		};
+	};
+};
diff --git a/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-sd.dtso b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-sd.dtso
new file mode 100644
index 000000000000..68ecfb2bb5c0
--- /dev/null
+++ b/arch/arm64/boot/dts/mediatek/mt7987a-bananapi-bpi-r4-lite-sd.dtso
@@ -0,0 +1,31 @@
+// SPDX-License-Identifier: (GPL-2.0 OR MIT)
+/*
+ * Copyright (C) 2025 MediaTek Inc.
+ * Author: Frank Wunderlich <frank-w@public-files.de>
+ */
+
+/dts-v1/;
+/plugin/;
+
+#include <dt-bindings/gpio/gpio.h>
+
+/ {
+	compatible = "bananapi,bpi-r4-lite", "mediatek,mt7987a";
+};
+
+&{/soc/mmc@11230000} {
+	max-frequency = <52000000>;
+	pinctrl-names = "default", "state_uhs";
+	pinctrl-0 = <&sd_pins_default>;
+	pinctrl-1 = <&sd_pins_uhs>;
+	cd-gpios = <&pio 20 GPIO_ACTIVE_LOW>;
+	bus-width = <4>;
+	cap-sd-highspeed;
+	vmmc-supply = <&reg_3p3v>;
+	vqmmc-supply = <&reg_3p3v>;
+	no-mmc;
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+};
+
-- 
2.39.5

