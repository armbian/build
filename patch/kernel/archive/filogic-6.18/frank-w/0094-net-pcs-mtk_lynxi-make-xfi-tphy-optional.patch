From 75f626d68fc497a145eafd2beb6d9b2790b18ad9 Mon Sep 17 00:00:00 2001
From: Frank Wunderlich <frank-w@public-files.de>
Date: Sat, 27 Sep 2025 16:16:53 +0200
Subject: [PATCH 094/116] net: pcs: mtk_lynxi: make xfi-tphy optional

from sdk
https://git01.mediatek.com/plugins/gitiles/openwrt/feeds/mtk-openwrt-feeds/+/refs/heads/master/autobuild/unified/filogic/24.10/files/target/linux/mediatek/patches-6.6/999-2601-net-pcs-mtk-lynxi-add-pextp-reset.patch
---
 drivers/net/pcs/pcs-mtk-lynxi.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/net/pcs/pcs-mtk-lynxi.c b/drivers/net/pcs/pcs-mtk-lynxi.c
index 44b9dc93cd0e..53c97b549758 100644
--- a/drivers/net/pcs/pcs-mtk-lynxi.c
+++ b/drivers/net/pcs/pcs-mtk-lynxi.c
@@ -465,9 +465,12 @@ static int mtk_pcs_lynxi_probe(struct platform_device *pdev)
 	if (IS_ERR(mpcs->sgmii_tx))
 		return PTR_ERR(mpcs->sgmii_tx);
 
-	mpcs->xfi_tphy = devm_of_phy_get(mpcs->dev, np, NULL);
-	if (IS_ERR(mpcs->xfi_tphy))
-		return PTR_ERR(mpcs->xfi_tphy);
+	if (of_parse_phandle(dev->of_node, "phys", 0)) {
+		mpcs->xfi_tphy = devm_of_phy_get(mpcs->dev, dev->of_node, NULL);
+		if (IS_ERR(mpcs->xfi_tphy))
+			return PTR_ERR(mpcs->xfi_tphy);
+	} else
+		mpcs->xfi_tphy = NULL;
 
 	pcs = mtk_pcs_lynxi_init(dev, regmap, (uintptr_t)of_device_get_match_data(dev),
 				 flags, mpcs);
-- 
2.39.5

