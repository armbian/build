From 37fc53eecaff4c1cc77b49103fa1b5c5ccd699c3 Mon Sep 17 00:00:00 2001
From: Christian Marangi <ansuelsmth@gmail.com>
Date: Thu, 16 Oct 2025 13:15:45 +0200
Subject: [PATCH 037/116] net: pcs: mediatek: usxgmii: TEST INBAND DISABLED
 UXGMII

Signed-off-by: Christian Marangi <ansuelsmth@gmail.com>
---
 drivers/net/pcs/pcs-mtk-usxgmii.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/pcs/pcs-mtk-usxgmii.c b/drivers/net/pcs/pcs-mtk-usxgmii.c
index c2fa0ba8fcc7..a288a4dda418 100644
--- a/drivers/net/pcs/pcs-mtk-usxgmii.c
+++ b/drivers/net/pcs/pcs-mtk-usxgmii.c
@@ -121,7 +121,9 @@ static int mtk_usxgmii_pcs_config(struct phylink_pcs *pcs, unsigned int neg_mode
 	bool mode_changed = false;
 
 	if (interface == PHY_INTERFACE_MODE_USXGMII) {
-		an_ctrl = FIELD_PREP(USXGMII_AN_SYNC_CNT, 0x1FF) | USXGMII_AN_ENABLE;
+		an_ctrl = FIELD_PREP(USXGMII_AN_SYNC_CNT, 0x1FF);
+		if (neg_mode == PHYLINK_PCS_NEG_INBAND_ENABLED)
+			an_ctrl |= USXGMII_AN_ENABLE;
 		link_timer = FIELD_PREP(USXGMII_LINK_TIMER_IDLE_DETECT, 0x7B) |
 			     FIELD_PREP(USXGMII_LINK_TIMER_COMP_ACK_DETECT, 0x7B) |
 			     FIELD_PREP(USXGMII_LINK_TIMER_AN_RESTART, 0x7B);
@@ -349,7 +351,7 @@ static unsigned int mtk_usxgmii_pcs_inband_caps(struct phylink_pcs *pcs,
 	case PHY_INTERFACE_MODE_5GBASER:
 	case PHY_INTERFACE_MODE_10GBASER:
 	case PHY_INTERFACE_MODE_USXGMII:
-		return LINK_INBAND_ENABLE;
+		return LINK_INBAND_ENABLE | LINK_INBAND_DISABLE;
 
 	default:
 		return 0;
-- 
2.39.5

