From 6c08db21a2f0d37c9ffeba6c327aff67e3be28da Mon Sep 17 00:00:00 2001
From: Frank Wunderlich <frank-w@public-files.de>
Date: Sun, 3 Nov 2024 11:18:31 +0100
Subject: [PATCH 50/84] arm64: dts: update bpi-r4.dtsi to actual state

---
 .../dts/mediatek/mt7988a-bananapi-bpi-r4.dts  |  1 +
 .../dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi | 40 +++++++++++++++++--
 2 files changed, 38 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dts b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dts
index 4b3796ba82e3..499f0c91c213 100644
--- a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dts
+++ b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dts
@@ -27,6 +27,7 @@ &gmac1 {
 	managed = "in-band-status";
 	phy-mode = "usxgmii";
 	sfp = <&sfp2>;
+	status = "okay";
 };
 
 &pca9545 {
diff --git a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi
index 38e27ef6bc0c..a614729e9e47 100644
--- a/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi
+++ b/arch/arm64/boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi
@@ -3,6 +3,7 @@
 /dts-v1/;
 
 #include <dt-bindings/gpio/gpio.h>
+#include <dt-bindings/input/input.h>
 #include <dt-bindings/regulator/richtek,rt5190a-regulator.h>
 #include <dt-bindings/leds/common.h>
 
@@ -13,10 +14,20 @@ aliases {
 		ethernet0 = &gmac0;
 		ethernet1 = &gmac1;
 		ethernet2 = &gmac2;
+		led-boot = &led_green;
+		led-failsafe = &led_green;
+		led-running = &led_green;
+		led-upgrade = &led_green;
 	};
 
 	chosen {
 		stdout-path = "serial0:115200n8";
+		bootargs = "loglevel=8 pci=pcie_bus_perf ubi.block=0,fit root=/dev/fit0";
+		rootdisk-spim-nand = <&ubi_rootfs>;
+	};
+
+	memory {
+		reg = <0x00 0x40000000 0x00 0x10000000>;
 	};
 
 	fan: pwm-fan {
@@ -28,6 +39,16 @@ fan: pwm-fan {
 		status = "okay";
 	};
 
+	gpio-keys {
+		compatible = "gpio-keys";
+
+		wps {
+			label = "WPS";
+			linux,code = <KEY_RESTART>;
+			gpios = <&pio 14 GPIO_ACTIVE_LOW>;
+		};
+	};
+
 	gpio-leds {
 		compatible = "gpio-leds";
 
@@ -151,6 +172,7 @@ &gmac2 {
 	managed = "in-band-status";
 	phy-mode = "usxgmii";
 	sfp = <&sfp1>;
+	status = "okay";
 };
 
 &gsw_phy0 {
@@ -280,7 +302,7 @@ pca9545: i2c-mux@70 {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		i2c@0 {
+		i2c@0 { //eeprom,rtc,ngff
 			#address-cells = <1>;
 			#size-cells = <0>;
 			reg = <0>;
@@ -288,12 +310,16 @@ i2c@0 {
 			pcf8563: rtc@51 {
 				compatible = "nxp,pcf8563";
 				reg = <0x51>;
+				//interrupts = <&pio 6 IRQ_TYPE_LEVEL_LOW>;
 				#clock-cells = <0>;
+				//status = "disabled";
 			};
 
 			eeprom@57 {
 				compatible = "atmel,24c02";
 				reg = <0x57>;
+				address-bits = <8>;
+				page-size = <8>;
 				size = <256>;
 			};
 
@@ -304,6 +330,14 @@ i2c_sfp1: i2c@1 {
 			#size-cells = <0>;
 			reg = <1>;
 		};
+
+		i2c_wifi: i2c@3 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <3>;
+
+			status = "disabled";
+		};
 	};
 };
 
@@ -455,7 +489,7 @@ partition@200000 {
 			reg = <0x200000 0x7e00000>;
 			compatible = "linux,ubi";
 
-			/*volumes {
+			volumes {
 				ubi-volume-fip {
 					volname = "fip";
 				};
@@ -477,7 +511,7 @@ nvmem-layout {
 				ubi_rootfs: ubi-volume-rootfs {
 					volname = "rootfs";
 				};
-			};*/
+			};
 		};
 	};
 };
-- 
2.30.2

