From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ricardo Pardini <ricardo@pardini.net>
Date: Sun, 18 Feb 2024 15:01:10 +0100
Subject: boot_rkimg: don't try rockchip_u2phy_vbus_detect when RECOVERY button
 pressed

---
 arch/arm/mach-rockchip/boot_rkimg.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-rockchip/boot_rkimg.c b/arch/arm/mach-rockchip/boot_rkimg.c
index f1a683d4e8e..f79aed467bc 100644
--- a/arch/arm/mach-rockchip/boot_rkimg.c
+++ b/arch/arm/mach-rockchip/boot_rkimg.c
@@ -322,14 +322,14 @@ void setup_download_mode(void)
 
 	boot_devtype_init();
 
-	printf("setup_download_mode checking if download %skey pressed... ",
+	printf("setup_download_mode checking if download %skey pressed...\n",
 	       is_hotkey(HK_ROCKUSB_DNL) ? "is HOT YES" : "is NOT HOT");
 	
 	if (rockchip_dnl_key_pressed() || is_hotkey(HK_ROCKUSB_DNL)) {
 		printf("download %skey pressed... ",
 		       is_hotkey(HK_ROCKUSB_DNL) ? "hot" : "");
 #ifdef CONFIG_CMD_ROCKUSB
-		vbus = rockchip_u2phy_vbus_detect();
+		// vbus = rockchip_u2phy_vbus_detect(); // rpardini: don't do this, it fails with -19
 #endif
 		if (vbus > 0) {
 			printf("%sentering download mode vbus > 0...\n",
-- 
Armbian

