From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Marvin Wewer <mwewer37@proton.me>
Date: Sun, 4 Jan 2026 21:16:16 +0000
Subject: arm64: dts: allwinner: sun55i-t527-orangepi-4a: Enable SPI0 and PCIe with ComboPHY

Signed-off-by: Marvin Wewer <mwewer37@proton.me>
---
 dts/upstream/src/arm64/allwinner/sun55i-t527-orangepi-4a.dts | 38 ++++++++--
 1 file changed, 38 insertions(+)

diff --git a/dts/upstream/src/arm64/allwinner/sun55i-t527-orangepi-4a.dts b/dts/upstream/src/arm64/allwinner/sun55i-t527-orangepi-4a.dts
index 111111111111..222222222222 100644
--- a/dts/upstream/src/arm64/allwinner/sun55i-t527-orangepi-4a.dts
+++ b/dts/upstream/src/arm64/allwinner/sun55i-t527-orangepi-4a.dts
@@ -152,10 +152,22 @@
 	vcc-pg-supply = <&reg_bldo1>;
 	vcc-ph-supply = <&reg_cldo3>;	/* via VCC-IO */
 	vcc-pi-supply = <&reg_cldo3>;
 	vcc-pj-supply = <&reg_cldo1>;
 	vcc-pk-supply = <&reg_cldo1>;
+
+			spi0_pc_pins: spi0-pc-pins {
+				pins = "PC2", "PC4", "PC12";
+				function = "spi0";
+				allwinner,pinmux = <4>;
+			};
+
+			spi0_cs0_pc_pin: spi0-cs0-pc-pin {
+				pins = "PC3";
+				function = "spi0";
+				allwinner,pinmux = <4>;
+			};
 };
 
 &r_i2c0 {
 	status = "okay";
 
@@ -368,10 +390,36 @@
 		host-wakeup-gpios = <&r_pio 1 4 GPIO_ACTIVE_HIGH>; /* PM4 */
 		shutdown-gpios = <&r_pio 1 2 GPIO_ACTIVE_HIGH>; /* PM2 */
 	};
 };
 
+&combophy {
+	select3v3-supply = <&reg_cldo3>;
+	status = "okay";
+};
+
+&spi0 {
+	pinctrl-0 = <&spi0_pc_pins>, <&spi0_cs0_pc_pin>;
+	pinctrl-names = "default";
+	status = "okay";
+	xm25qu128c: flash@0 {
+		compatible = "xmc,xm25qu128c", "jedec,spi-nor";
+		reg = <0>;
+		spi-max-frequency = <20000000>;
+		vcc-supply = <&reg_cldo1>;
+		status = "okay";
+	};
+};
+
+&pcie {
+	reset-gpios = <&pio 7 11 GPIO_ACTIVE_HIGH>;
+	wake-gpios = <&pio 7 12 GPIO_ACTIVE_HIGH>;
+	num-lanes = <2>;
+	slot-3v3-supply = <&reg_pcie_vcc3v3>; 
+	status = "okay";
+};
+
 &usb_otg {
 	/*
 	 * The OTG controller is connected to one of the type-A ports.
 	 * There is a regulator, controlled by a GPIO, to provide VBUS power
 	 * to the port, and a VBUSDET GPIO, to detect externally provided
@@ -386,5 +414,6 @@
 	usb0_vbus-supply = <&reg_otg_vbus>;
 	usb0_vbus_det-gpios = <&r_pio 0 7 GPIO_ACTIVE_HIGH>; /* PL7 */
 	usb1_vbus-supply = <&reg_usb_vbus>;
 	status = "okay";
 };
+
-- 
Armbian

